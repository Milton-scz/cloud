import{p as f,T as U,h as x,f as s,a as k,u as l,w as C,F as S,o as n,Z as _,b as o,t as i,g as d,i as m,k as T,l as L,m as p,bX as M}from"./app-l7-T_QVc.js";import{_ as O}from"./AuthenticatedLayout-D5lz5BQL.js";import"./index-DUepgUvg.js";import"./ApplicationLogo-Dn1V6JC9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const P={key:0,class:"fixed inset-0 flex justify-center items-center bg-black bg-opacity-50"},F={class:"bg-white p-6 rounded-lg shadow-lg"},j={class:"text-lg font-bold text-center"},q={class:"py-12"},Q={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},A={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},B={class:"p-6 text-gray-900 dark:text-gray-100"},G={class:"flex flex-col md:flex-row space-y-6 md:space-y-0 md:space-x-6"},H={class:"md:w-1/2 space-y-4"},J={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},X={class:"space-y-6"},Z=["value"],$={key:0,class:"text-sm text-red-500 mt-2"},K={key:0,class:"text-sm text-red-500 mt-2"},W={key:0,class:"text-sm text-red-500 mt-2"},Y={key:0,class:"text-sm text-red-500 mt-2"},ee={class:"space-y-6"},te={key:0,class:"text-sm text-red-500 mt-2"},oe={key:0,class:"text-sm text-red-500 mt-2"},le={key:0,class:"text-sm text-red-500 mt-2"},re={key:0,class:"text-sm text-red-500 mt-2"},ae={class:"md:w-1/2 flex justify-center items-center"},se={key:0,class:"w-full max-w-md"},ne=["src"],pe={__name:"generarventa",props:{users:Array,qrImage:String,numeroTransaccion:String},setup(N){const g=f(""),v=f(""),y=f(""),b=f(!1),w=N;g.value=w.qrImage;const e=U({name:"",cedula:"",tnTelefono:"",tcRazonSocial:"",tcCorreo:"",tcCiNit:"",tnMonto:.01,taPedidoDetalle:[],tnTipoServicio:""});x(()=>{var r;return((r=window.Laravel)==null?void 0:r.roles)||[]}),x(()=>{var r;return((r=window.Laravel)==null?void 0:r.permissions)||[]}),x(()=>{var r;return((r=window.Laravel)==null?void 0:r.user)||{}});const u=f(null),R=()=>{const r={};return e.name||(r.name="El nombre es obligatorio."),e.cedula||(r.cedula="La cédula es obligatoria."),e.tcCorreo?/\S+@\S+\.\S+/.test(e.tcCorreo)||(r.tcCorreo="Por favor ingresa un correo válido."):r.tcCorreo="El correo es obligatorio.",e.tnTelefono||(r.tnTelefono="El teléfono es obligatorio."),e.tcCiNit||(r.tcCiNit="El CI/NIT es obligatorio."),e.tcRazonSocial||(r.tcRazonSocial="La razón social es obligatoria."),(!e.tnMonto||e.tnMonto<=0)&&(r.tnMonto="El monto total debe ser mayor a 0."),e.tnTipoServicio||(r.tnTipoServicio="Selecciona un tipo de servicio."),r},I=r=>{r.preventDefault(),e.errors={};const t=R();if(Object.keys(t).length>0){for(const[c,E]of Object.entries(t))e.errors[c]=E;return}const a=localStorage.getItem("carrito");if(a)try{e.taPedidoDetalle=JSON.parse(a)}catch(c){console.error("Error al parsear los datos de pedidoDetalle:",c)}console.log("form:",e),console.log("URL:",route("admin.pagos.generarCobro")),M.post(route("admin.pagos.generarCobro"),e).then(c=>{console.log(c.data.qrImage),g.value=c.data.qrImage,v.value=c.data.nroTransaccion,console.log("Número transacción:",v.value),V(v.value)}).catch(c=>{console.log("Hubo un error al crear la venta",c)})},V=r=>{const t=setInterval(async()=>{try{console.log("Entrando en la consulta de transacción:",r),(await M.get(route("landing.pagos.consultar"),{params:{venta_id:r}})).data.trim()==="COMPLETADO-PROCESADO"&&(clearInterval(t),z("Su pedido fue pagado con éxito!!!!"))}catch(a){console.error("Error al consultar la transacción:",a)}},1e4)};function z(r){y.value=r,b.value=!0}function D(){b.value=!1}const h=()=>{u.value&&(e.name=u.value.name,e.cedula=u.value.cedula,e.tcCorreo=u.value.email,e.tnTelefono=u.value.celular,e.tcCiNit=u.value.cedula||"",e.tcRazonSocial="GRUPO-01",e.tnMonto=.01)};return(r,t)=>(n(),s(S,null,[k(l(_),{title:"Crear Venta"}),k(O,null,{header:C(()=>t[9]||(t[9]=[o("h2",{class:"text-xl font-semibold leading-tight text-gray-800"},"Crear Venta",-1)])),default:C(()=>[b.value?(n(),s("div",P,[o("div",F,[o("p",j,i(y.value),1),o("div",{class:"mt-4 flex justify-center"},[o("button",{onClick:D,class:"bg-blue-500 text-white p-2 rounded"},"Cerrar")])])])):d("",!0),o("div",q,[o("div",Q,[o("div",A,[o("div",B,[t[23]||(t[23]=o("div",{class:"mb-6 text-center"},[o("h3",{class:"text-3xl font-bold"},"PagoFacil QR y Tigo Money"),o("p",{class:"text-blue-500"},"Integración de servicios PagoFacil")],-1)),o("div",G,[o("div",H,[t[22]||(t[22]=o("h3",{class:"text-2xl font-bold"},"Datos para la factura",-1)),o("form",{onSubmit:I,target:"QrImage"},[o("div",J,[o("div",X,[o("div",null,[t[11]||(t[11]=o("label",{for:"cliente",class:"block text-sm font-medium text-gray-700"},"Cliente",-1)),m(o("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),onChange:h,id:"cliente",name:"cliente",class:"mt-1 block w-full border-2 border-gray-400 text-gray-800 bg-white rounded-md shadow-sm"},[t[10]||(t[10]=o("option",{value:"",disabled:""},"Seleccionar Cliente",-1)),(n(!0),s(S,null,L(w.users,a=>(n(),s("option",{key:a.id,value:a},i(a.name),9,Z))),128))],544),[[T,u.value]])]),o("div",null,[t[12]||(t[12]=o("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"Nombre",-1)),m(o("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>l(e).name=a),type:"text",id:"name",name:"name",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[p,l(e).name]]),l(e).errors.name?(n(),s("p",$,i(l(e).errors.name),1)):d("",!0)]),o("div",null,[t[13]||(t[13]=o("label",{for:"cedula",class:"block text-sm font-medium text-gray-700"},"Cédula",-1)),m(o("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>l(e).cedula=a),type:"text",id:"cedula",name:"cedula",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[p,l(e).cedula]]),l(e).errors.cedula?(n(),s("p",K,i(l(e).errors.cedula),1)):d("",!0)]),o("div",null,[t[14]||(t[14]=o("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Correo",-1)),m(o("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>l(e).tcCorreo=a),type:"email",id:"email",name:"email",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[p,l(e).tcCorreo]]),l(e).errors.tcCorreo?(n(),s("p",W,i(l(e).errors.tcCorreo),1)):d("",!0)]),o("div",null,[t[15]||(t[15]=o("label",{for:"telefono",class:"block text-sm font-medium text-gray-700"},"Teléfono",-1)),m(o("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>l(e).tnTelefono=a),type:"text",id:"telefono",name:"telefono",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[p,l(e).tnTelefono]]),l(e).errors.tnTelefono?(n(),s("p",Y,i(l(e).errors.tnTelefono),1)):d("",!0)])]),o("div",ee,[o("div",null,[t[16]||(t[16]=o("label",{for:"ciNit",class:"block text-sm font-medium text-gray-700"},"CI/NIT",-1)),m(o("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>l(e).tcCiNit=a),type:"text",id:"ciNit",name:"ciNit",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[p,l(e).tcCiNit]]),l(e).errors.tcCiNit?(n(),s("p",te,i(l(e).errors.tcCiNit),1)):d("",!0)]),o("div",null,[t[17]||(t[17]=o("label",{for:"tcRazonSocial",class:"block text-sm font-medium text-gray-700"},"Razón Social",-1)),m(o("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>l(e).tcRazonSocial=a),type:"text",id:"tcRazonSocial",name:"tcRazonSocial",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[p,l(e).tcRazonSocial]]),l(e).errors.tcRazonSocial?(n(),s("p",oe,i(l(e).errors.tcRazonSocial),1)):d("",!0)]),o("div",null,[t[18]||(t[18]=o("label",{for:"tnMonto",class:"block text-sm font-medium text-gray-700"},"Monto Total",-1)),m(o("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>l(e).tnMonto=a),type:"decimal",id:"tnMonto",name:"tnMonto",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[p,l(e).tnMonto]]),l(e).errors.tnMonto?(n(),s("p",le,i(l(e).errors.tnMonto),1)):d("",!0)]),o("div",null,[t[20]||(t[20]=o("label",{for:"tipoServicio",class:"block text-sm font-medium text-gray-700"},"Tipo de Servicio",-1)),m(o("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>l(e).tnTipoServicio=a),id:"tipoServicio",class:"mt-1 block w-full border p-2 rounded-md shadow-sm"},t[19]||(t[19]=[o("option",{value:"1"},"Servicio QR",-1),o("option",{value:"2"},"Tigo Money",-1)]),512),[[T,l(e).tnTipoServicio]]),l(e).errors.tnTipoServicio?(n(),s("p",re,i(l(e).errors.tnTipoServicio),1)):d("",!0)])])]),t[21]||(t[21]=o("div",{class:"mt-6 text-right"},[o("button",{type:"submit",class:"bg-blue-500 text-white px-6 py-2 rounded-md"},"Generar Cobro")],-1))],32)]),o("div",ae,[g.value?(n(),s("div",se,[o("img",{src:g.value,alt:"QR Code",class:"w-full h-auto"},null,8,ne)])):d("",!0)])])])])])])]),_:1})],64))}};export{pe as default};
